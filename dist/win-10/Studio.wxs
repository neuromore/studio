<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:fire="http://wixtoolset.org/schemas/v4/wxs/firewall">

  <?ifndef $(var.APPNAME) ?>
    <?error APPNAME must be set ?>
  <?endif ?>
  <?ifndef $(var.APPCOMPANY) ?>
    <?error APPCOMPANY must be set ?>
  <?endif ?>
  <?ifndef $(var.VERSION) ?>
    <?error VERSION must be set ?>
  <?endif ?>

  <?if $(sys.BUILDARCH) = x64 ?>
    <?define PlatformProductName = "$(var.APPNAME) (x64)" ?>
    <?define PlatformUpgradeCode = "1AB189BA-5B13-4448-A916-4E25B814D2AA" ?>
  <?elseif $(sys.BUILDARCH) = x86 ?>
    <?define PlatformProductName = "$(var.APPNAME) (x86)" ?>
    <?define PlatformUpgradeCode = "1AB189BA-5B13-4448-A916-4E25B814D2AB" ?>
  <?elseif $(sys.BUILDARCH) = arm64 ?>
    <?define PlatformProductName = "$(var.APPNAME) (arm64)" ?>
    <?define PlatformUpgradeCode = "1AB189BA-5B13-4448-A916-4E25B814D2AC" ?>
  <?else ?>
    <?error Unsupported BUILDARCH ?>
  <?endif ?>

  <Package 
    Language="1033" 
    Manufacturer="$(var.APPCOMPANY)"
    Name="$(var.PlatformProductName)"
    UpgradeCode="$(var.PlatformUpgradeCode)"
    Version="$(var.VERSION)">
	
    <Icon Id="app.ico" SourceFile="resources\app.ico"/>
    
	<Property Id="ARPPRODUCTICON" Value="app.ico" />

    <MajorUpgrade DowngradeErrorMessage="A later version of [ProductName] is already installed. Setup will now exit." />

    <MediaTemplate EmbedCab="yes" />

    <!-- Program Files Folder -->
    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLFOLDER" Name="$(var.APPNAME)" />
    </StandardDirectory>

    <!-- Start Menu Folder -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="STARTMENUFOLDER" Name="$(var.APPNAME)"/>
    </StandardDirectory>

    <ComponentGroup Directory="INSTALLFOLDER" Id="ProgramFiles">
      <Component Id="Studio.exe">
        <File Id="Studio.exe" KeyPath="yes" Source="$(sys.BUILDARCH)/Studio.exe" />
        <fire:FirewallException Id="StudioTCP" Name="StudioTCP" File="Studio.exe" Profile="private" Protocol="tcp" Scope="any" />
        <fire:FirewallException Id="StudioUDP" Name="StudioUDP" File="Studio.exe" Profile="private" Protocol="udp" Scope="any" />
      </Component>
    </ComponentGroup>

    <DirectoryRef Id="STARTMENUFOLDER">
      <Component Id="ApplicationShortcut" Guid="$(var.PlatformUpgradeCode)">
        <Shortcut Id="ApplicationStartMenuShortcut" 
                  Name="$(var.PlatformProductName)"
                  Description="Biofeedback"
                  Target="[#Studio.exe]"
                  WorkingDirectory="INSTALLFOLDER"/>
        <RemoveFolder Id="CleanUpShortCut" Directory="STARTMENUFOLDER" On="uninstall"/>
      </Component>
    </DirectoryRef>

    <Feature Id="StudioFeature">
      <ComponentGroupRef Id="ProgramFiles" />
      <ComponentRef Id="ApplicationShortcut" />
    </Feature>

  </Package>
</Wix>
